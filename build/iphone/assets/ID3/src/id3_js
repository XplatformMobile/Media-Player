function getTagReader(t){return"ftypM4A"==t.getStringAt(4,7)?ID4:"ID3"==t.getStringAt(0,3)?ID3v2:ID3v1}function readTags(t,e,n,r){var i=t.readTagsFromData(e,r),r=_files[n]||{};for(var a in i)i.hasOwnProperty(a)&&(r[a]=i[a]);_files[n]=r}var ID4=require("./id4"),ID3v1=require("./id3v1"),ID3v2=require("./id3v2"),BufferedBinaryAjax=require("./bufferedbinaryajax"),FileAPIReader=require("./filereader");"undefined"!=typeof window&&(window.FileAPIReader=FileAPIReader);var ID3={},_files={},_formatIDRange=[0,7];ID3.clearTags=function(t){delete _files[t]},ID3.clearAll=function(){_files={}},ID3.loadTags=function(t,e,n){n=n||{};var r=n.dataReader||BufferedBinaryAjax;r(t,function(r){r.loadRange(_formatIDRange,function(){var i=getTagReader(r);i.loadData(r,function(){readTags(i,r,t,n.tags),e&&e()})})},n.onError)},ID3.getAllTags=function(t){if(!_files[t])return null;var e={};for(var n in _files[t])_files[t].hasOwnProperty(n)&&(e[n]=_files[t][n]);return e},ID3.getTag=function(t,e){return _files[t]?_files[t][e]:null},ID3.FileAPIReader=FileAPIReader,ID3.loadTags=ID3.loadTags,ID3.getAllTags=ID3.getAllTags,ID3.getTag=ID3.getTag,ID3.clearTags=ID3.clearTags,ID3.clearAll=ID3.clearAll,module.exports=ID3;