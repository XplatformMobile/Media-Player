function loadAtom(e,t,r,a){var n=e.getLongAt(t,!0);if(0==n)return a();var i=e.getStringAt(t+4,4);if(["moov","udta","meta","ilst"].indexOf(i)>-1)"meta"==i&&(t+=4),e.loadRange([t+8,t+8+8],function(){loadAtom(e,t+8,n-8,a)});else{var o=i in ID4.atom;e.loadRange([t+(o?0:n),t+n+8],function(){loadAtom(e,t+n,r,a)})}}function readAtom(e,t,r,a,n){n=void 0===n?"":n+"  ";for(var i=r;r+a>i;){var o=t.getLongAt(i,!0);if(0==o)return;var s=t.getStringAt(i+4,4);if(["moov","udta","meta","ilst"].indexOf(s)>-1)return"meta"==s&&(i+=4),void readAtom(e,t,i+8,o-8,n);if(ID4.atom[s]){var u=t.getInteger24At(i+16+1,!0),l=ID4.atom[s],c=ID4.types[u];if("trkn"==s)e[l[0]]=t.getByteAt(i+16+11),e.count=t.getByteAt(i+16+13);else{var g,d=i+16+4+4,f=o-16-4-4;switch(c){case"text":g=t.getStringWithCharsetAt(d,f,"UTF-8");break;case"uint8":g=t.getShortAt(d);break;case"jpeg":case"png":g={format:"image/"+c,data:t.getBytesAt(d,f)}}"comment"===l[0]?e[l[0]]={text:g}:e[l[0]]=g}}i+=o}}var ID4={};ID4.types={0:"uint8",1:"text",13:"jpeg",14:"png",21:"uint8"},ID4.atom={"©alb":["album"],"©art":["artist"],"©ART":["artist"],aART:["artist"],"©day":["year"],"©nam":["title"],"©gen":["genre"],trkn:["track"],"©wrt":["composer"],"©too":["encoder"],cprt:["copyright"],covr:["picture"],"©grp":["grouping"],keyw:["keyword"],"©lyr":["lyrics"],"©cmt":["comment"],tmpo:["tempo"],cpil:["compilation"],disk:["disc"]},ID4.loadData=function(e,t){e.loadRange([0,7],function(){loadAtom(e,0,e.getLength(),t)})},ID4.readTagsFromData=function(e){var t={};return readAtom(t,e,0,e.getLength()),t},module.exports=ID4;