function getTagsFromShortcuts(e){for(var t,r=[],n=0;t=e[n];n++)r=r.concat(_shortcuts[t]||[t]);return r}function readSynchsafeInteger32At(e,t){var r=t.getByteAt(e),n=t.getByteAt(e+1),i=t.getByteAt(e+2),a=t.getByteAt(e+3),o=127&a|(127&i)<<7|(127&n)<<14|(127&r)<<21;return o}function readFrameFlags(e,t){var r={message:{tag_alter_preservation:e.isBitSetAt(t,6),file_alter_preservation:e.isBitSetAt(t,5),read_only:e.isBitSetAt(t,4)},format:{grouping_identity:e.isBitSetAt(t+1,7),compression:e.isBitSetAt(t+1,3),encription:e.isBitSetAt(t+1,2),unsynchronisation:e.isBitSetAt(t+1,1),data_length_indicator:e.isBitSetAt(t+1,0)}};return r}function readFrames(e,t,r,n,i){var a,o={},s=n.major;for(i=getTagsFromShortcuts(i||_defaultShortcuts);t>e;){var l=null,u=r,c=e,d=null;switch(s){case 2:var f=u.getStringAt(c,3),g=u.getInteger24At(c+3,!0),T=6;break;case 3:var f=u.getStringAt(c,4),g=u.getLongAt(c+4,!0),T=10;break;case 4:var f=u.getStringAt(c,4),g=readSynchsafeInteger32At(c+4,u),T=10}if(""==f)break;if(e+=T+g,!(i.indexOf(f)<0||(s>2&&(d=readFrameFlags(u,c+8)),c+=T,d&&d.format.data_length_indicator&&(a=readSynchsafeInteger32At(c,u),c+=4,g-=4),d&&d.format.unsynchronisation))){f in ID3v2.readFrameData?l=ID3v2.readFrameData[f]:"T"==f[0]&&(l=ID3v2.readFrameData["T*"]);var h=l?l(c,g,u,d):void 0,y=f in ID3v2.frames?ID3v2.frames[f]:"Unknown",m={id:f,size:g,description:y,data:h};f in o?(o[f].id&&(o[f]=[o[f]]),o[f].push(m)):o[f]=m}}return o}function getFrameData(e,t){"string"==typeof t&&(t=[t]);for(var r,n=0;r=t[n];n++)if(r in e)return e[r].data}var ID3v2=require("./id3v2frames");ID3v2.frames={BUF:"Recommended buffer size",CNT:"Play counter",COM:"Comments",CRA:"Audio encryption",CRM:"Encrypted meta frame",ETC:"Event timing codes",EQU:"Equalization",GEO:"General encapsulated object",IPL:"Involved people list",LNK:"Linked information",MCI:"Music CD Identifier",MLL:"MPEG location lookup table",PIC:"Attached picture",POP:"Popularimeter",REV:"Reverb",RVA:"Relative volume adjustment",SLT:"Synchronized lyric/text",STC:"Synced tempo codes",TAL:"Album/Movie/Show title",TBP:"BPM (Beats Per Minute)",TCM:"Composer",TCO:"Content type",TCR:"Copyright message",TDA:"Date",TDY:"Playlist delay",TEN:"Encoded by",TFT:"File type",TIM:"Time",TKE:"Initial key",TLA:"Language(s)",TLE:"Length",TMT:"Media type",TOA:"Original artist(s)/performer(s)",TOF:"Original filename",TOL:"Original Lyricist(s)/text writer(s)",TOR:"Original release year",TOT:"Original album/Movie/Show title",TP1:"Lead artist(s)/Lead performer(s)/Soloist(s)/Performing group",TP2:"Band/Orchestra/Accompaniment",TP3:"Conductor/Performer refinement",TP4:"Interpreted, remixed, or otherwise modified by",TPA:"Part of a set",TPB:"Publisher",TRC:"ISRC (International Standard Recording Code)",TRD:"Recording dates",TRK:"Track number/Position in set",TSI:"Size",TSS:"Software/hardware and settings used for encoding",TT1:"Content group description",TT2:"Title/Songname/Content description",TT3:"Subtitle/Description refinement",TXT:"Lyricist/text writer",TXX:"User defined text information frame",TYE:"Year",UFI:"Unique file identifier",ULT:"Unsychronized lyric/text transcription",WAF:"Official audio file webpage",WAR:"Official artist/performer webpage",WAS:"Official audio source webpage",WCM:"Commercial information",WCP:"Copyright/Legal information",WPB:"Publishers official webpage",WXX:"User defined URL link frame",AENC:"Audio encryption",APIC:"Attached picture",COMM:"Comments",COMR:"Commercial frame",ENCR:"Encryption method registration",EQUA:"Equalization",ETCO:"Event timing codes",GEOB:"General encapsulated object",GRID:"Group identification registration",IPLS:"Involved people list",LINK:"Linked information",MCDI:"Music CD identifier",MLLT:"MPEG location lookup table",OWNE:"Ownership frame",PRIV:"Private frame",PCNT:"Play counter",POPM:"Popularimeter",POSS:"Position synchronisation frame",RBUF:"Recommended buffer size",RVAD:"Relative volume adjustment",RVRB:"Reverb",SYLT:"Synchronized lyric/text",SYTC:"Synchronized tempo codes",TALB:"Album/Movie/Show title",TBPM:"BPM (beats per minute)",TCOM:"Composer",TCON:"Content type",TCOP:"Copyright message",TDAT:"Date",TDLY:"Playlist delay",TENC:"Encoded by",TEXT:"Lyricist/Text writer",TFLT:"File type",TIME:"Time",TIT1:"Content group description",TIT2:"Title/songname/content description",TIT3:"Subtitle/Description refinement",TKEY:"Initial key",TLAN:"Language(s)",TLEN:"Length",TMED:"Media type",TOAL:"Original album/movie/show title",TOFN:"Original filename",TOLY:"Original lyricist(s)/text writer(s)",TOPE:"Original artist(s)/performer(s)",TORY:"Original release year",TOWN:"File owner/licensee",TPE1:"Lead performer(s)/Soloist(s)",TPE2:"Band/orchestra/accompaniment",TPE3:"Conductor/performer refinement",TPE4:"Interpreted, remixed, or otherwise modified by",TPOS:"Part of a set",TPUB:"Publisher",TRCK:"Track number/Position in set",TRDA:"Recording dates",TRSN:"Internet radio station name",TRSO:"Internet radio station owner",TSIZ:"Size",TSRC:"ISRC (international standard recording code)",TSSE:"Software/Hardware and settings used for encoding",TYER:"Year",TXXX:"User defined text information frame",UFID:"Unique file identifier",USER:"Terms of use",USLT:"Unsychronized lyric/text transcription",WCOM:"Commercial information",WCOP:"Copyright/Legal information",WOAF:"Official audio file webpage",WOAR:"Official artist/performer webpage",WOAS:"Official audio source webpage",WORS:"Official internet radio station homepage",WPAY:"Payment",WPUB:"Publishers official webpage",WXXX:"User defined URL link frame"};var _shortcuts={title:["TIT2","TT2"],artist:["TPE1","TP1"],album:["TALB","TAL"],year:["TYER","TYE"],comment:["COMM","COM"],track:["TRCK","TRK"],genre:["TCON","TCO"],picture:["APIC","PIC"],lyrics:["USLT","ULT"]},_defaultShortcuts=["title","artist","album","track"];ID3v2.loadData=function(e,t){e.loadRange([0,readSynchsafeInteger32At(6,e)],t)},ID3v2.readTagsFromData=function(e,t){var r=0,n=e.getByteAt(r+3);if(n>4)return{version:">2.4"};var i=e.getByteAt(r+4),a=e.isBitSetAt(r+5,7),o=e.isBitSetAt(r+5,6),s=e.isBitSetAt(r+5,5),l=readSynchsafeInteger32At(r+6,e);if(r+=10,o){var u=e.getLongAt(r,!0);r+=u+4}var c={version:"2."+n+"."+i,major:n,revision:i,flags:{unsynchronisation:a,extended_header:o,experimental_indicator:s},size:l},d=a?{}:readFrames(r,l-10,e,c,t);for(var f in _shortcuts)if(_shortcuts.hasOwnProperty(f)){var e=getFrameData(d,_shortcuts[f]);e&&(c[f]=e)}for(var g in d)d.hasOwnProperty(g)&&(c[g]=d[g]);return c},module.exports=ID3v2;